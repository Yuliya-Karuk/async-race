var u=Object.defineProperty;var v=(d,e,n)=>e in d?u(d,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):d[e]=n;var t=(d,e,n)=>(v(d,typeof e!="symbol"?e+"":e,n),n);import{S as C,W as b,C as x}from"./svgComponent-WQx8ZGwf.js";import{B as p,c as s,S as o,O as l,s as _,a as N}from"./index-DHYfWUqA.js";const P="winner",W="winner_head",y="winner_head",H="winner-wins",T="winner-time",B="winner-image",I="winner-id",S="winner-name",w={winner:P,winner_head:W,winnerHead:y,"winner-wins":"winner-wins",winnerWins:H,"winner-time":"winner-time",winnerTime:T,"winner-image":"winner-image",winnerImage:B,"winner-id":"winner-id",winnerId:I,"winner-name":"winner-name",winnerName:S};class L extends p{constructor(n,i,r){super("div",["winners-row"]);t(this,"name");t(this,"color");t(this,"time");t(this,"index");t(this,"id");t(this,"wins");this.name=i.name,this.color=i.color,this.wins=n.wins,this.time=n.time,this.id=n.id,this.index=r,this.createContent()}createContent(){const n=s("div",[w.winnerId],void 0,[{innerText:`${this.index}`}]),i=new C(this.color,this.id),r=s("div",[w.winnerImage],void 0,void 0,[i.getNode()]),c=s("div",[w.winnerName],void 0,[{innerText:this.name}]),m=s("div",[w.winnerWins],void 0,[{innerText:`${this.wins}`}]),g=s("div",[w.winnerTime],void 0,[{innerText:`${this.time}`}]);this.appendChildren([n,r,c,m,g])}}const O="winners",f="winners-row",A="winners-row_head",k="winners-column",$="winners-column_sorted_asc",E="winners-column_sorted_desc",R="winners-content",V="order-icon",a={winners:O,"winners-row":"winners-row",winnersRow:f,"winners-row_head":"winners-row_head",winnersRowHead:A,"winners-column":"winners-column",winnersColumn:k,"winners-column_sorted_asc":"winners-column_sorted_asc",winnersColumnSortedAsc:$,"winners-column_sorted_desc":"winners-column_sorted_desc",winnersColumnSortedDesc:E,"winners-content":"winners-content",winnersContent:R,"order-icon":"order-icon",orderIcon:V},h={1:"â„–",2:"Car",3:"Name",4:"Winnings",5:"Best time (s)"};class D extends p{constructor(){super("div",[a.winners]);t(this,"winnersBlock");t(this,"timeHead");t(this,"winsHead");t(this,"winsOrderIcon");t(this,"timeOrderIcon");t(this,"pgnNext");t(this,"pgnText");t(this,"pgnPrevious");t(this,"total")}createTableHead(){const n=s("div",[a.winnersRow,"winners-row_head"]);Object.values(h).forEach(i=>{if(i===h[4])this.winsOrderIcon=s("span",[a.orderIcon]),this.winsHead=s("div",[a.winnersColumn],void 0,[{innerText:i}],[this.winsOrderIcon]),n.append(this.winsHead);else if(i===h[5])this.timeOrderIcon=s("span",[a.orderIcon]),this.timeHead=s("div",[a.winnersColumn,"winners-column_sorted_asc"],void 0,[{innerText:i}],[this.timeOrderIcon]),n.append(this.timeHead);else{const r=s("div",[a.winnersColumn],void 0,[{innerText:i}]);n.append(r)}}),this.appendChildren([n])}renderPagination(){this.pgnNext=s("button",["btn","pgn-button","pgn-button_next"],{type:"button"},void 0,[s("span",["pgn-icon"])]),this.pgnPrevious=s("button",["btn","pgn-button","pgn-button_previous"],{type:"button"},void 0,[s("span",["pgn-icon"])]),this.pgnText=s("p",["pgn-text"]),this.total=s("h4",["pgn-total"]);const n=s("div",["pgn-container"],void 0,void 0,[this.pgnPrevious,this.pgnText,this.pgnNext,this.total]);this.appendChildren([n])}setPagination(n,i){this.pgnNext.removeAttribute("disabled"),this.pgnPrevious.removeAttribute("disabled");const r=Math.ceil(i/10)===0?1:Math.ceil(i/10);this.pgnText.innerText=`${n} / ${r}`,this.total.innerText=`Winners total: ${i}`,n===1&&this.pgnPrevious.setAttribute("disabled","disabled"),n===r&&this.pgnNext.setAttribute("disabled","disabled")}createWinnersContainer(){this.winnersBlock=s("div",[a.winnersContent]),this.appendChildren([this.winnersBlock])}cleanWinnersContainer(){this.winnersBlock.replaceChildren()}setSortingColumns(n,i){this.winsHead.className=a.winnersColumn,this.timeHead.className=a.winnersColumn,n===o.time?this.timeHead.classList.add(`winners-column_sorted_${i.toLowerCase()}`):this.winsHead.classList.add(`winners-column_sorted_${i.toLowerCase()}`)}}class q{constructor(){t(this,"view");t(this,"pageNumber");t(this,"sortBy",o.time);t(this,"order",l.ASC);this.view=new D,this.pageNumber=1,this.renderStaticParts()}renderStaticParts(){this.view.createTableHead(),this.view.createWinnersContainer(),this.view.renderPagination(),this.bindPaginationListeners(),this.bindSortingListeners()}bindPaginationListeners(){this.view.pgnNext.addEventListener("click",()=>this.handlePagination(1)),this.view.pgnPrevious.addEventListener("click",()=>this.handlePagination(-1))}bindSortingListeners(){this.view.winsHead.addEventListener("click",()=>this.handleSorting(o.wins)),this.view.timeHead.addEventListener("click",()=>this.handleSorting(o.time))}async loadPage(){const{data:e,totalCount:n}=await b.getWinners(this.pageNumber,this.sortBy,this.order);this.view.setPagination(this.pageNumber,n),this.renderWinners(e)}async renderWinners(e){this.view.cleanWinnersContainer();const n=e.map(async(r,c)=>await this.renderOneWinner(r,c));(await Promise.all(n)).forEach(r=>this.view.winnersBlock.append(r.getNode()))}async renderOneWinner(e,n){const i=(this.pageNumber-1)*10+n+1,r=await x.getCar(e.id);return new L(e,r,i)}handlePagination(e){this.pageNumber+=e,this.loadPage()}async handleSorting(e){this.sortBy===o.wins&&e===o.wins||this.sortBy===o.time&&e===o.time?this.order=_(this.order):(this.sortBy===o.time&&e===o.wins||this.sortBy===o.wins&&e===o.time)&&(this.sortBy=N(this.sortBy),this.order=l.ASC),this.view.setSortingColumns(this.sortBy,this.order),await this.loadPage()}}export{q as Winners};
